<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Trolley Dilemma Deneyi</title>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f0f2f5;
      color: #222;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .ekran {
      display: none;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 4px 24px rgba(0,0,0,0.10);
      padding: 40px 48px;
      max-width: 820px;
      width: 100%;
      animation: fadeIn 0.3s ease;
    }
    .ekran.aktif { display: block; }

    @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }

    h1 { font-size: 1.8rem; margin-bottom: 12px; color: #1a1a2e; }
    h2 { font-size: 1.3rem; margin-bottom: 20px; color: #16213e; }
    p  { line-height: 1.7; margin-bottom: 12px; color: #444; }

    .bilgi-kutusu {
      background: #eef2ff;
      border-left: 4px solid #4f46e5;
      border-radius: 6px;
      padding: 14px 18px;
      margin-bottom: 20px;
      font-size: 0.95rem;
    }

    .btn {
      display: inline-block;
      padding: 12px 28px;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      cursor: pointer;
      transition: background 0.2s, transform 0.1s;
    }
    .btn:active { transform: scale(0.97); }
    .btn-primary { background: #4f46e5; color: #fff; }
    .btn-primary:hover { background: #4338ca; }
    .btn-gray { background: #e5e7eb; color: #333; }
    .btn-gray:hover { background: #d1d5db; }
    .btn:disabled { opacity: 0.5; cursor: not-allowed; }
    .btn-satir { margin-top: 28px; display: flex; gap: 12px; justify-content: flex-end; flex-wrap: wrap; }

    .form-grup { margin-bottom: 22px; }
    .form-grup label { display: block; font-weight: 600; margin-bottom: 8px; font-size: 0.95rem; }
    .form-grup input[type="text"],
    .form-grup input[type="number"],
    .form-grup select {
      width: 100%;
      padding: 10px 14px;
      border: 1.5px solid #d1d5db;
      border-radius: 7px;
      font-size: 0.95rem;
      outline: none;
      transition: border 0.2s;
    }
    .form-grup input:focus,
    .form-grup select:focus { border-color: #4f46e5; }

    .likert-grup { margin-bottom: 26px; }
    .likert-grup .soru-metni { font-size: 0.95rem; margin-bottom: 10px; font-weight: 500; }
    .likert-secenekler {
      display: flex;
      gap: 6px;
      align-items: center;
      flex-wrap: nowrap;
    }
    .likert-secenekler .uc-label {
      font-size: 0.72rem;
      color: #777;
      white-space: nowrap;
    }
    .likert-secenekler .radio-grup {
      display: flex;
      gap: 4px;
      flex: 1;
      justify-content: center;
    }
    .likert-secenekler input[type="radio"] { display: none; }
    .likert-secenekler label.radio-label {
      width: 34px; height: 34px;
      border: 2px solid #d1d5db;
      border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      font-size: 0.82rem; font-weight: 700;
      cursor: pointer; transition: all 0.15s;
      color: #555;
      flex-shrink: 0;
    }
    .likert-secenekler input[type="radio"]:checked + label.radio-label {
      background: #4f46e5;
      border-color: #4f46e5;
      color: #fff;
    }
    .likert-secenekler label.radio-label:hover {
      border-color: #4f46e5;
      color: #4f46e5;
    }

    .bolum-bant {
      background: #1a1a2e;
      color: #fff;
      border-radius: 8px;
      padding: 12px 20px;
      margin-bottom: 24px;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .bolum-bant .bolum-no {
      background: #4f46e5;
      border-radius: 50%;
      width: 32px; height: 32px;
      display: flex; align-items: center; justify-content: center;
      font-weight: 800; font-size: 0.95rem; flex-shrink: 0;
    }

    .hata { color: #dc2626; font-size: 0.85rem; margin-top: 6px; display: none; }

    .spinner {
      width: 48px; height: 48px;
      border: 5px solid #e5e7eb;
      border-top-color: #4f46e5;
      border-radius: 50%;
      animation: spin 0.9s linear infinite;
      margin: 20px auto;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    @media (max-width: 600px) {
      .ekran { padding: 24px 18px; }
      .likert-secenekler { flex-wrap: wrap; }
    }

    /* GGES */
    .gges-madde {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 14px 0;
      border-bottom: 1px solid #f3f4f6;
    }
    .gges-madde:last-child { border-bottom: none; }
    .gges-sifat {
      font-weight: 700;
      font-size: 1rem;
      color: #1a1a2e;
      min-width: 100px;
      flex-shrink: 0;
    }
    .gges-secenekler {
      display: flex;
      flex-wrap: nowrap;
      gap: 6px;
      flex: 1;
    }
    .gges-radio-label {
      display: flex;
      align-items: center;
      gap: 4px;
      cursor: pointer;
      padding: 6px 10px;
      border: 2px solid #d1d5db;
      border-radius: 8px;
      font-size: 0.78rem;
      color: #444;
      transition: all 0.15s;
      background: #fff;
      user-select: none;
      white-space: nowrap;
      flex: 1;
      justify-content: center;
    }
    .gges-radio-label input[type="radio"] { display: none; }
    .gges-radio-label:hover {
      border-color: #4f46e5;
      color: #4f46e5;
      background: #eef2ff;
    }
    .gges-radio-label:has(input:checked) {
      border-color: #4f46e5;
      background: #4f46e5;
      color: #fff;
    }
    @media (max-width: 700px) {
      .gges-madde { flex-direction: column; align-items: flex-start; }
      .gges-secenekler { flex-wrap: wrap; }
    }

    /* AKTÃ–R */
    .gorsel-sahne {
      text-align: center;
      margin-bottom: 24px;
    }
    .gorsel-sahne img {
      max-width: 100%;
      max-height: 400px;
      border-radius: 10px;
      border: 2px solid #e5e7eb;
      object-fit: contain;
    }

    .ilerleme-kap {
      background: #e5e7eb;
      border-radius: 999px;
      height: 8px;
      margin-bottom: 8px;
      overflow: hidden;
    }
    .ilerleme-ic {
      background: #4f46e5;
      height: 100%;
      border-radius: 999px;
      transition: width 0.4s ease;
    }
    .ilerleme-metin {
      font-size: 0.82rem;
      color: #888;
      text-align: right;
      margin-bottom: 20px;
    }

    .tus-alani {
      display: flex;
      gap: 16px;
      justify-content: center;
      margin: 20px 0;
    }
    .tus-kutu {
      border: 3px solid #d1d5db;
      border-radius: 12px;
      padding: 20px 40px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
      min-width: 160px;
      user-select: none;
    }
    .tus-kutu:hover { border-color: #4f46e5; background: #eef2ff; }
    .tus-kutu.secildi-ceker { border-color: #059669; background: #d1fae5; }
    .tus-kutu.secildi-cekmez { border-color: #dc2626; background: #fee2e2; }
    .tus-harf {
      font-size: 2.2rem;
      font-weight: 900;
      display: block;
      margin-bottom: 6px;
    }
    .tus-aciklama {
      font-size: 0.9rem;
      color: #555;
      font-weight: 600;
    }
  </style>
</head>
<body>

<!-- EKRAN 0: KARÅILAMA -->
<section id="ekran-hosgeldin" class="ekran aktif">
  <h1>Trolley Problemi Deneyi</h1>
  <div class="bilgi-kutusu">
    Bu Ã§alÄ±ÅŸma, ahlaki karar verme sÃ¼reÃ§lerini incelemek amacÄ±yla tasarlanmÄ±ÅŸ bir psikoloji deneyidir.
  </div>
  <p>Ã‡alÄ±ÅŸmaya katÄ±lÄ±m <strong>gÃ¶nÃ¼llÃ¼lÃ¼k esasÄ±na</strong> dayanmaktadÄ±r. Verilen yanÄ±tlar tamamen anonim tutulacak ve yalnÄ±zca bilimsel amaÃ§larla kullanÄ±lacaktÄ±r.</p>
  <p>Deneyi istediÄŸiniz herhangi bir aÅŸamada sonlandÄ±rabilirsiniz. Tahmini tamamlanma sÃ¼resi <strong>15-20 dakikadÄ±r</strong>.</p>
  <p>Devam ederek aydÄ±nlatÄ±lmÄ±ÅŸ onam formunu kabul etmiÅŸ sayÄ±lÄ±rsÄ±nÄ±z.</p>
  <div class="btn-satir">
    <button class="btn btn-primary" onclick="ekranGec('ekran-demografik')">BaÅŸla â†’</button>
  </div>
</section>


<!-- EKRAN 1: DEMOGRAFÄ°K -->
<section id="ekran-demografik" class="ekran">
  <div class="bolum-bant">
    <div class="bolum-no">1</div>
    <div>Demografik Bilgiler</div>
  </div>
  <div class="form-grup">
    <label>1. Bir takma isim giriniz</label>
    <input type="text" id="dem-takma-isim" placeholder="Takma isminizi yazÄ±n" />
  </div>
  <div class="form-grup">
    <label>2. YaÅŸÄ±nÄ±z</label>
    <input type="number" id="dem-yas" min="18" max="99" placeholder="Ã–rn: 24" />
  </div>
  <div class="form-grup">
    <label>3. Cinsiyetiniz</label>
    <select id="dem-cinsiyet">
      <option value="">-- SeÃ§iniz --</option>
      <option>Erkek</option>
      <option>KadÄ±n</option>
      <option>Belirtmek istemiyorum</option>
    </select>
  </div>
  <div class="form-grup">
    <label>4. Gelir Durumunuz</label>
    <select id="dem-gelir">
      <option value="">-- SeÃ§iniz --</option>
      <option>0 - 17.000 â‚º</option>
      <option>17.000 - 35.000 â‚º</option>
      <option>35.000 - 57.000 â‚º</option>
      <option>57.000 â‚º ve Ã¼stÃ¼</option>
    </select>
  </div>
  <div class="form-grup">
    <label>5. Dini Ä°nancÄ±nÄ±z</label>
    <select id="dem-din">
      <option value="">-- SeÃ§iniz --</option>
      <option>Hristiyan</option>
      <option>Budist</option>
      <option>Hindu</option>
      <option>MÃ¼slÃ¼man</option>
      <option>Yahudi</option>
      <option>Ateist</option>
      <option>Deist</option>
      <option>Agnostik</option>
      <option>DiÄŸer</option>
    </select>
  </div>
  <div class="form-grup">
    <label>6. Kendinizi hangi dÃ¼zeyde dindar olarak gÃ¶rÃ¼yorsunuz?</label>
    <select id="dem-dindarlik">
      <option value="">-- SeÃ§iniz --</option>
      <option>Dindar deÄŸilim</option>
      <option>Biraz dindarÄ±m</option>
      <option>Orta derecede dindarÄ±m</option>
      <option>Ã‡ok dindarÄ±m</option>
      <option>Bilmiyorum</option>
    </select>
  </div>
  <div class="form-grup">
    <label>7. Siyasi aÃ§Ä±dan TÃ¼rkiye'de yÄ±llardÄ±r sol, saÄŸ ve merkez diye bir siyasi gelenek vardÄ±r. Siz kendinizi aÅŸaÄŸÄ±daki Ã¶lÃ§ekte hangi konumda gÃ¶rÃ¼yorsunuz?</label>
    <div class="likert-grup" style="margin-top:10px;">
      <div class="likert-secenekler">
        <span class="uc-label">AÅŸÄ±rÄ± Sol</span>
        <div class="radio-grup" id="dem-siyasi-konum-rg"></div>
        <span class="uc-label">AÅŸÄ±rÄ± SaÄŸ</span>
      </div>
    </div>
  </div>
  <div class="form-grup">
    <label>8. Kendinizi siyasi gÃ¶rÃ¼ÅŸÃ¼nÃ¼ze hangi dÃ¼zeyde baÄŸlÄ± olarak gÃ¶rÃ¼yorsunuz?</label>
    <select id="dem-siyasi-baglilik">
      <option value="">-- SeÃ§iniz --</option>
      <option>HiÃ§ baÄŸlÄ± deÄŸilim</option>
      <option>Az baÄŸlÄ±yÄ±m</option>
      <option>Orta dÃ¼zeyde baÄŸlÄ±yÄ±m</option>
      <option>OldukÃ§a baÄŸlÄ±yÄ±m</option>
      <option>Tamamen baÄŸlÄ±yÄ±m</option>
    </select>
  </div>
  <div id="dem-hata" class="hata">LÃ¼tfen tÃ¼m alanlarÄ± doldurun.</div>
  <div class="btn-satir">
    <button class="btn btn-gray" onclick="ekranGec('ekran-hosgeldin')">â† Geri</button>
    <button class="btn btn-primary" onclick="demografikDogrula()">Devam â†’</button>
  </div>
</section>


<!-- EKRAN 2a: KÄ°MLÄ°K KAYNAÅIM AÃ‡IKLAMA -->
<section id="ekran-kimlik-aciklama" class="ekran">
  <div class="bolum-bant">
    <div class="bolum-no">2</div>
    <div>Kimlik KaynaÅŸÄ±m Ã–lÃ§eÄŸi</div>
  </div>
  <p>Birazdan gÃ¶receÄŸiniz sorularÄ±n doÄŸru cevabÄ± yoktur. LÃ¼tfen ekranda gÃ¶receÄŸiniz sorularÄ± kendi bakÄ±ÅŸ aÃ§Ä±nÄ±za gÃ¶re mÃ¼mkÃ¼n olduÄŸunca objektif bir biÃ§imde cevaplayÄ±nÄ±z.</p>
  <p style="margin-top:16px; font-weight:600; font-size:1.05rem; color:#1a1a2e;">
    BaÄŸlÄ± bulunduÄŸunuz grubu TÃ¼rklÃ¼k Ã¼zerinden tanÄ±mladÄ±ÄŸÄ±nÄ±zda;
  </p>
  <div class="btn-satir">
    <button class="btn btn-gray" onclick="ekranGec('ekran-demografik')">â† Geri</button>
    <button class="btn btn-primary" onclick="ekranGec('ekran-kimlik')">Devam â†’</button>
  </div>
</section>


<!-- EKRAN 2b: KÄ°MLÄ°K KAYNAÅIM SORULARI -->
<section id="ekran-kimlik" class="ekran">
  <div class="bolum-bant">
    <div class="bolum-no">2</div>
    <div>Kimlik KaynaÅŸÄ±m Ã–lÃ§eÄŸi</div>
  </div>
  <p class="bilgi-kutusu">
    AÅŸaÄŸÄ±daki ifadelerin sizin iÃ§in ne kadar doÄŸru olduÄŸunu 1 (Kesinlikle KatÄ±lmÄ±yorum) ile 7 (Kesinlikle KatÄ±lÄ±yorum) arasÄ±nda deÄŸerlendirin.
  </p>
  <div id="kimlik-sorular"></div>
  <div id="kimlik-hata" class="hata">LÃ¼tfen tÃ¼m sorularÄ± yanÄ±tlayÄ±n.</div>
  <div class="btn-satir">
    <button class="btn btn-gray" onclick="ekranGec('ekran-kimlik-aciklama')">â† Geri</button>
    <button class="btn btn-primary" onclick="kimlikDogrula()">Devam â†’</button>
  </div>
</section>


<!-- EKRAN 3a: GGES AÃ‡IKLAMA -->
<section id="ekran-gges-aciklama" class="ekran">
  <div class="bolum-bant">
    <div class="bolum-no">3</div>
    <div>GGES Ã–lÃ§eÄŸi</div>
  </div>
  <p>AÅŸaÄŸÄ±da TÃ¼rk ve TÃ¼rk olmayan insanlarla ilgili birtakÄ±m sÄ±fatlar yer almaktadÄ±r. TÃ¼rk ve TÃ¼rk olmayan gruplarÄ± ayrÄ± ayrÄ± dÃ¼ÅŸÃ¼nerek, her sÄ±fatÄ±n her grubu ne kadar iyi tanÄ±mladÄ±ÄŸÄ±nÄ± belirtiniz.</p>
  <p style="margin-top:12px;">SorularÄ±n doÄŸru veya yanlÄ±ÅŸ cevabÄ± yoktur, bizim iÃ§in Ã¶nemli olan sizin ne dÃ¼ÅŸÃ¼ndÃ¼ÄŸÃ¼nÃ¼zdÃ¼r.</p>
  <p style="margin-top:12px;">LÃ¼tfen <strong>1 (HiÃ§ tanÄ±mlamÄ±yor)</strong> ile <strong>5 (Tamamen tanÄ±mlÄ±yor)</strong> arasÄ±nda derecelendirilmiÅŸ sorular Ã¼zerinde her bir sÄ±fatÄ±n <strong>TÃ¼rk</strong> ve <strong>TÃ¼rk olmayan</strong> grubu sizce ne kadar iyi tanÄ±mladÄ±ÄŸÄ±nÄ± iÅŸaretleyiniz.</p>
  <div class="btn-satir">
    <button class="btn btn-gray" onclick="ekranGec('ekran-kimlik')">â† Geri</button>
    <button class="btn btn-primary" onclick="ekranGec('ekran-gges-turk')">Devam â†’</button>
  </div>
</section>


<!-- EKRAN 3b: GGES â€“ TÃœRK GRUPLAR -->
<section id="ekran-gges-turk" class="ekran">
  <div class="bolum-bant">
    <div class="bolum-no">3</div>
    <div>GGES Ã–lÃ§eÄŸi â€“ TÃ¼rk Gruplar</div>
  </div>
  <p class="bilgi-kutusu">1 = HiÃ§ tanÄ±mlamÄ±yor &nbsp;Â·&nbsp; 5 = Tamamen tanÄ±mlÄ±yor</p>
  <p style="margin-bottom:20px; font-weight:600; font-size:1.05rem; color:#1a1a2e;">TÃ¼rk gruplar iÃ§in;</p>
  <div id="gges-turk-sorular"></div>
  <div id="gges-turk-hata" class="hata">LÃ¼tfen tÃ¼m sorularÄ± yanÄ±tlayÄ±n.</div>
  <div class="btn-satir">
    <button class="btn btn-gray" onclick="ekranGec('ekran-gges-aciklama')">â† Geri</button>
    <button class="btn btn-primary" onclick="ggesTogrula()">Devam â†’</button>
  </div>
</section>


<!-- EKRAN 3c: GGES â€“ TÃœRK OLMAYAN GRUPLAR -->
<section id="ekran-gges-to" class="ekran">
  <div class="bolum-bant">
    <div class="bolum-no">3</div>
    <div>GGES Ã–lÃ§eÄŸi â€“ TÃ¼rk Olmayan Gruplar</div>
  </div>
  <p class="bilgi-kutusu">1 = HiÃ§ tanÄ±mlamÄ±yor &nbsp;Â·&nbsp; 5 = Tamamen tanÄ±mlÄ±yor</p>
  <p style="margin-bottom:20px; font-weight:600; font-size:1.05rem; color:#1a1a2e;">TÃ¼rk olmayan gruplar iÃ§in;</p>
  <div id="gges-to-sorular"></div>
  <div id="gges-to-hata" class="hata">LÃ¼tfen tÃ¼m sorularÄ± yanÄ±tlayÄ±n.</div>
  <div class="btn-satir">
    <button class="btn btn-gray" onclick="ekranGec('ekran-gges-turk')">â† Geri</button>
    <button class="btn btn-primary" onclick="ggesToOgrula()">Devam â†’</button>
  </div>
</section>


<!-- EKRAN 4a: AKTÃ–R AÃ‡IKLAMA -->
<section id="ekran-aktor-aciklama" class="ekran">
  <div class="bolum-bant">
    <div class="bolum-no">4</div>
    <div>AktÃ¶r SenaryolarÄ±</div>
  </div>
  <p>Birazdan size bir dizi senaryo gÃ¶sterilecektir. Her senaryoda bir karar vermeniz gerekecektir.</p>
  <p style="margin-top:12px;">KararÄ±nÄ±zÄ± klavyenizdeki <strong>D</strong> veya <strong>K</strong> tuÅŸuyla belirteceksiniz. Her senaryoda hangi tuÅŸun ne anlama geldiÄŸi ekranda aÃ§Ä±kÃ§a gÃ¶sterilecektir.</p>
  <p style="margin-top:12px; font-style:italic; color:#666;">LÃ¼tfen her senaryoyu dikkatlice inceledikten sonra kararÄ±nÄ±zÄ± verin.</p>
  <div class="btn-satir">
    <button class="btn btn-gray" onclick="ekranGec('ekran-gges-to')">â† Geri</button>
    <button class="btn btn-primary" onclick="aktorBaslat()">BaÅŸla â†’</button>
  </div>
</section>


<!-- EKRAN 4b: AKTÃ–R SENARYOLARI -->
<section id="ekran-aktor" class="ekran">
  <div class="bolum-bant">
    <div class="bolum-no">4</div>
    <div>AktÃ¶r SenaryolarÄ±</div>
  </div>

  <div class="ilerleme-metin" id="aktor-ilerleme-metin"></div>
  <div class="ilerleme-kap">
    <div class="ilerleme-ic" id="aktor-ilerleme-ic" style="width:0%"></div>
  </div>

  <div class="gorsel-sahne">
    <img id="aktor-gorsel" src="" alt="Senaryo gÃ¶rseli" />
  </div>

  <div class="tus-alani">
    <div class="tus-kutu" id="tus-d" onclick="aktorYanit('D')">
      <span class="tus-harf">D</span>
      <span class="tus-aciklama" id="tus-d-label">Ã‡ekerim</span>
    </div>
    <div class="tus-kutu" id="tus-k" onclick="aktorYanit('K')">
      <span class="tus-harf">K</span>
      <span class="tus-aciklama" id="tus-k-label">Ã‡ekmem</span>
    </div>
  </div>

  <p style="text-align:center; font-size:0.82rem; color:#aaa; margin-top:4px;">
    Klavye ile D veya K tuÅŸuna basabilirsiniz.
  </p>

  <div class="btn-satir">
    <button class="btn btn-primary" id="aktor-ileri-btn" onclick="aktorIleri()" disabled>Sonraki â†’</button>
  </div>
</section>


<!-- EKRAN: GÃ–NDERÄ°M -->
<section id="ekran-gonderim" class="ekran">
  <h2 style="text-align:center;">Verileriniz gÃ¶nderiliyorâ€¦</h2>
  <div class="spinner"></div>
  <p style="text-align:center; color:#555;">LÃ¼tfen bu sayfayÄ± kapatmayÄ±n.</p>
</section>


<!-- EKRAN: BÄ°TÄ°Å -->
<section id="ekran-bitis" class="ekran">
  <h1>TeÅŸekkÃ¼rler! ğŸ‰</h1>
  <p>KatÄ±lÄ±mÄ±nÄ±z iÃ§in teÅŸekkÃ¼r ederiz. YanÄ±tlarÄ±nÄ±z baÅŸarÄ±yla kaydedildi.</p>
</section>


<script>
// ================================================================
// YAPILANDIRMA
// ================================================================

const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/BURAYA_URL_GIRIN/exec";

const KIMLIK_SORULARI = [
  { id: "kimlik_1", metin: "Grubumla bir bÃ¼tÃ¼nÃ¼m." },
  { id: "kimlik_2", metin: "Grubumla bÃ¼tÃ¼nleÅŸmiÅŸ hissediyorum." },
  { id: "kimlik_3", metin: "Grubumla aramda derin bir duygusal baÄŸÄ±m var." },
  { id: "kimlik_4", metin: "Grubum ben demektir." },
  { id: "kimlik_5", metin: "Grubum iÃ§in diÄŸer grup Ã¼yelerinin yapacaÄŸÄ±ndan daha fazlasÄ±nÄ± yaparÄ±m." },
  { id: "kimlik_6", metin: "Grubum sayesinde gÃ¼Ã§lÃ¼yÃ¼m." },
  { id: "kimlik_7", metin: "BaÄŸlÄ± bulunduÄŸum grubu gÃ¼Ã§lÃ¼ hale getiriyorum." },
];

const GGES_SORULARI = [
  { id: "gges_1", metin: "Ä°yi" },
  { id: "gges_2", metin: "Nazik" },
  { id: "gges_3", metin: "DÃ¼rÃ¼st" },
  { id: "gges_4", metin: "GÃ¼venilir" },
  { id: "gges_5", metin: "Aksi" },
  { id: "gges_6", metin: "Kaba" },
  { id: "gges_7", metin: "GÃ¼venilmez" },
  { id: "gges_8", metin: "KÃ¶tÃ¼" },
];

// ================================================================
// AKTÃ–R SENARYOLARI
// mapping: "DK" â†’ D=Ã‡ekerim, K=Ã‡ekmem
//          "KD" â†’ D=Ã‡ekmem,  K=Ã‡ekerim
// GÃ¶rseller her katÄ±lÄ±mcÄ±da farklÄ± sÄ±rada (randomize) gÃ¶sterilir.
// ================================================================
const AKTOR_SENARYOLARI = [
  { id: "A1", gorsel: "Aktorsenaryo1.png", mapping: "DK" },
  { id: "A2", gorsel: "Aktorsenaryo2.png", mapping: "DK" },
  { id: "A3", gorsel: "Aktorsenaryo3.png", mapping: "DK" },
  { id: "A4", gorsel: "Aktorsenaryo4.png", mapping: "KD" },
  { id: "A5", gorsel: "Aktorsenaryo5.png", mapping: "KD" },
  { id: "A6", gorsel: "Aktorsenaryo6.png", mapping: "KD" },
];

// ================================================================
// DURUM DEÄÄ°ÅKENLERÄ°
// ================================================================
let veri = {};
let aktorSira = [];
let aktorIndex = 0;
let aktorMevcutYanit = null;

// ================================================================
// YARDIMCI FONKSÄ°YONLAR
// ================================================================

function ekranGec(id) {
  document.querySelectorAll('.ekran').forEach(e => e.classList.remove('aktif'));
  document.getElementById(id).classList.add('aktif');
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

// Fisher-Yates karÄ±ÅŸtÄ±rma â€” her katÄ±lÄ±mcÄ±da farklÄ± sÄ±ra
function karistir(arr) {
  const a = [...arr];
  for (let i = a.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}

function likertRadioUret(containerId, isim, max = 6) {
  const el = document.getElementById(containerId);
  el.innerHTML = '';
  for (let i = 1; i <= max; i++) {
    el.innerHTML += `
      <input type="radio" name="${isim}" id="${isim}_${i}" value="${i}" />
      <label class="radio-label" for="${isim}_${i}">${i}</label>
    `;
  }
}

function likertDegerOku(isim) {
  const s = document.querySelector(`input[name="${isim}"]:checked`);
  return s ? parseInt(s.value) : null;
}

function olcekUret(containerId, sorular, isim, max = 6) {
  const el = document.getElementById(containerId);
  el.innerHTML = '';
  sorular.forEach(soru => {
    el.innerHTML += `
      <div class="likert-grup">
        <div class="soru-metni">${soru.metin}</div>
        <div class="likert-secenekler">
          <span class="uc-label">Kesinlikle KatÄ±lmÄ±yorum</span>
          <div class="radio-grup" id="rg_${soru.id}"></div>
          <span class="uc-label">Kesinlikle KatÄ±lÄ±yorum</span>
        </div>
      </div>
    `;
    likertRadioUret(`rg_${soru.id}`, soru.id, max);
  });
}

function olcekVeriTopla(sorular) {
  const sonuc = {};
  for (const soru of sorular) {
    const d = likertDegerOku(soru.id);
    if (d === null) return null;
    sonuc[soru.id] = d;
  }
  return sonuc;
}

function ggesGrupUret(containerId, sorular, prefix) {
  const el = document.getElementById(containerId);
  el.innerHTML = '';
  const etiketler = [
    { deger: 1, metin: "HiÃ§ tanÄ±mlamÄ±yor" },
    { deger: 2, metin: "TanÄ±mlamÄ±yor" },
    { deger: 3, metin: "KararsÄ±zÄ±m" },
    { deger: 4, metin: "TanÄ±mlÄ±yor" },
    { deger: 5, metin: "Tamamen tanÄ±mlÄ±yor" },
  ];
  sorular.forEach(soru => {
    let radios = '';
    etiketler.forEach(e => {
      const id = `${prefix}_${soru.id}_${e.deger}`;
      radios += `
        <label class="gges-radio-label" for="${id}">
          <input type="radio" name="${prefix}_${soru.id}" id="${id}" value="${e.deger}" />
          <span>${e.metin}</span>
        </label>
      `;
    });
    el.innerHTML += `
      <div class="gges-madde">
        <div class="gges-sifat">${soru.metin}</div>
        <div class="gges-secenekler">${radios}</div>
      </div>
    `;
  });
}

function ggesGrupVeriTopla(sorular, prefix) {
  const sonuc = {};
  for (const soru of sorular) {
    const s = document.querySelector(`input[name="${prefix}_${soru.id}"]:checked`);
    if (!s) return null;
    sonuc[`${prefix}_${soru.id}`] = parseInt(s.value);
  }
  return sonuc;
}

// ================================================================
// BAÅLATMA
// ================================================================

window.addEventListener('load', () => {
  olcekUret('kimlik-sorular', KIMLIK_SORULARI, 'kimlik', 7);
  ggesGrupUret('gges-turk-sorular', GGES_SORULARI, 'gges_turk');
  ggesGrupUret('gges-to-sorular',   GGES_SORULARI, 'gges_to');

  const rg = document.getElementById('dem-siyasi-konum-rg');
  rg.innerHTML = '';
  for (let i = 1; i <= 7; i++) {
    rg.innerHTML += `
      <input type="radio" name="dem-siyasi-konum" id="siyasi_${i}" value="${i}" />
      <label class="radio-label" for="siyasi_${i}">${i}</label>
    `;
  }

  document.addEventListener('keydown', klavyeDinle);
});

// ================================================================
// DEMOGRAFÄ°K
// ================================================================

function demografikDogrula() {
  const takmaIsim      = document.getElementById('dem-takma-isim').value.trim();
  const yas            = document.getElementById('dem-yas').value.trim();
  const cinsiyet       = document.getElementById('dem-cinsiyet').value;
  const gelir          = document.getElementById('dem-gelir').value;
  const din            = document.getElementById('dem-din').value;
  const dindarlik      = document.getElementById('dem-dindarlik').value;
  const siyasiKonum    = likertDegerOku('dem-siyasi-konum');
  const siyasiBaglilik = document.getElementById('dem-siyasi-baglilik').value;

  if (!takmaIsim || !yas || !cinsiyet || !gelir || !din || !dindarlik || !siyasiKonum || !siyasiBaglilik) {
    document.getElementById('dem-hata').style.display = 'block';
    return;
  }
  document.getElementById('dem-hata').style.display = 'none';

  veri.takma_isim      = takmaIsim;
  veri.yas             = yas;
  veri.cinsiyet        = cinsiyet;
  veri.gelir           = gelir;
  veri.din             = din;
  veri.dindarlik       = dindarlik;
  veri.siyasi_konum    = siyasiKonum;
  veri.siyasi_baglilik = siyasiBaglilik;

  ekranGec('ekran-kimlik-aciklama');
}

// ================================================================
// KÄ°MLÄ°K KAYNAÅIM
// ================================================================

function kimlikDogrula() {
  const sonuc = olcekVeriTopla(KIMLIK_SORULARI);
  if (!sonuc) {
    document.getElementById('kimlik-hata').style.display = 'block';
    return;
  }
  document.getElementById('kimlik-hata').style.display = 'none';
  veri.kimlik = sonuc;
  ekranGec('ekran-gges-aciklama');
}

// ================================================================
// GGES â€“ TÃœRK
// ================================================================

function ggesTogrula() {
  const sonuc = ggesGrupVeriTopla(GGES_SORULARI, 'gges_turk');
  if (!sonuc) {
    document.getElementById('gges-turk-hata').style.display = 'block';
    return;
  }
  document.getElementById('gges-turk-hata').style.display = 'none';
  veri.gges_turk = sonuc;
  ekranGec('ekran-gges-to');
}

// ================================================================
// GGES â€“ TÃœRK OLMAYAN
// ================================================================

function ggesToOgrula() {
  const sonuc = ggesGrupVeriTopla(GGES_SORULARI, 'gges_to');
  if (!sonuc) {
    document.getElementById('gges-to-hata').style.display = 'block';
    return;
  }
  document.getElementById('gges-to-hata').style.display = 'none';
  veri.gges_turkolmayan = sonuc;
  ekranGec('ekran-aktor-aciklama');
}

// ================================================================
// AKTÃ–R SENARYOLARI
// ================================================================

function aktorBaslat() {
  // Her katÄ±lÄ±mcÄ±da farklÄ± rastgele sÄ±ra
  aktorSira  = karistir(AKTOR_SENARYOLARI);
  aktorIndex = 0;
  veri.aktor = [];
  // GÃ¶sterilen sÄ±rayÄ± da kaydet (hangi senaryo kaÃ§Ä±ncÄ± gÃ¶sterildi)
  veri.aktor_sirasi = aktorSira.map(s => s.id);
  ekranGec('ekran-aktor');
  aktorGorselGoster();
}

function aktorGorselGoster() {
  const toplam  = aktorSira.length;
  const senaryo = aktorSira[aktorIndex];

  document.getElementById('aktor-ilerleme-metin').textContent =
    `Senaryo ${aktorIndex + 1} / ${toplam}`;
  document.getElementById('aktor-ilerleme-ic').style.width =
    `${(aktorIndex / toplam) * 100}%`;

  document.getElementById('aktor-gorsel').src = senaryo.gorsel;

  // Counterbalance: mapping'e gÃ¶re tuÅŸ etiketlerini ayarla
  if (senaryo.mapping === "DK") {
    document.getElementById('tus-d-label').textContent = "Ã‡ekerim";
    document.getElementById('tus-k-label').textContent = "Ã‡ekmem";
  } else {
    document.getElementById('tus-d-label').textContent = "Ã‡ekmem";
    document.getElementById('tus-k-label').textContent = "Ã‡ekerim";
  }

  // TuÅŸlarÄ± sÄ±fÄ±rla
  document.getElementById('tus-d').className = 'tus-kutu';
  document.getElementById('tus-k').className = 'tus-kutu';
  document.getElementById('aktor-ileri-btn').disabled = true;
  aktorMevcutYanit = null;
}

function aktorYanit(tus) {
  if (aktorMevcutYanit) return; // Zaten cevap verilmiÅŸse tekrar iÅŸleme
  aktorMevcutYanit = tus;

  const senaryo = aktorSira[aktorIndex];
  const gercekKarar = (senaryo.mapping === "DK")
    ? (tus === "D" ? "Ã‡ekti" : "Ã‡ekmedi")
    : (tus === "D" ? "Ã‡ekmedi" : "Ã‡ekti");

  // GÃ¶rsel geri bildirim
  document.getElementById('tus-d').className =
    'tus-kutu' + (tus === 'D'
      ? (gercekKarar === "Ã‡ekti" ? ' secildi-ceker' : ' secildi-cekmez')
      : '');
  document.getElementById('tus-k').className =
    'tus-kutu' + (tus === 'K'
      ? (gercekKarar === "Ã‡ekti" ? ' secildi-ceker' : ' secildi-cekmez')
      : '');

  document.getElementById('aktor-ileri-btn').disabled = false;
}

function aktorIleri() {
  if (!aktorMevcutYanit) return;

  const senaryo = aktorSira[aktorIndex];
  const gercekKarar = (senaryo.mapping === "DK")
    ? (aktorMevcutYanit === "D" ? "Ã‡ekti" : "Ã‡ekmedi")
    : (aktorMevcutYanit === "D" ? "Ã‡ekmedi" : "Ã‡ekti");

  // CSV'ye gidecek veriler:
  // senaryo_id   â†’ hangi senaryo (A1-A6)
  // gosterim_sirasi â†’ bu katÄ±lÄ±mcÄ±da kaÃ§Ä±ncÄ± sÄ±rada gÃ¶sterildi
  // mapping      â†’ DK veya KD (counterbalance koÅŸulu)
  // basin_tus    â†’ katÄ±lÄ±mcÄ±nÄ±n bastÄ±ÄŸÄ± tuÅŸ (D/K)
  // gercek_karar â†’ Ã‡ekti / Ã‡ekmedi
  veri.aktor.push({
    senaryo_id:      senaryo.id,
    gosterim_sirasi: aktorIndex + 1,
    mapping:         senaryo.mapping,
    basin_tus:       aktorMevcutYanit,
    gercek_karar:    gercekKarar,
  });

  aktorIndex++;

  if (aktorIndex < aktorSira.length) {
    aktorGorselGoster();
  } else {
    // AktÃ¶r bitti â†’ veriyi gÃ¶nder
    // Bystander ve SS eklenince bu satÄ±r gÃ¼ncellenecek
    veriGonder();
  }
}

// ================================================================
// KLAVYE DÄ°NLEYÄ°CÄ°
// ================================================================

function klavyeDinle(e) {
  const tus = e.key.toUpperCase();
  if (tus !== 'D' && tus !== 'K') return;
  if (document.getElementById('ekran-aktor').classList.contains('aktif')) {
    aktorYanit(tus);
  }
}

// ================================================================
// VERÄ° GÃ–NDER â†’ GOOGLE APPS SCRIPT
// ================================================================

function veriGonder() {
  ekranGec('ekran-gonderim');
  veri.zaman    = new Date().toISOString();
  veri.tarayici = navigator.userAgent;

  fetch(GOOGLE_SCRIPT_URL, {
    method: 'POST',
    mode:   'no-cors',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(veri)
  })
  .then(() => ekranGec('ekran-bitis'))
  .catch(() => ekranGec('ekran-bitis'));
}


/*
================================================================
GOOGLE APPS SCRIPT KODU â€“ script.google.com'a yapÄ±ÅŸtÄ±rÄ±n
================================================================

function doPost(e) {
  const sheet = SpreadsheetApp.getActiveSpreadsheet().getActiveSheet();
  const d = JSON.parse(e.postData.contents);

  if (sheet.getLastRow() === 0) {
    sheet.appendRow([
      "zaman","tarayici",
      "takma_isim","yas","cinsiyet","gelir","din","dindarlik",
      "siyasi_konum","siyasi_baglilik",
      "kimlik_1","kimlik_2","kimlik_3","kimlik_4","kimlik_5","kimlik_6","kimlik_7",
      "gges_turk_1","gges_turk_2","gges_turk_3","gges_turk_4",
      "gges_turk_5","gges_turk_6","gges_turk_7","gges_turk_8",
      "gges_to_1","gges_to_2","gges_to_3","gges_to_4",
      "gges_to_5","gges_to_6","gges_to_7","gges_to_8",
      "aktor_sirasi",
      "A1_sira","A1_mapping","A1_basin_tus","A1_gercek_karar",
      "A2_sira","A2_mapping","A2_basin_tus","A2_gercek_karar",
      "A3_sira","A3_mapping","A3_basin_tus","A3_gercek_karar",
      "A4_sira","A4_mapping","A4_basin_tus","A4_gercek_karar",
      "A5_sira","A5_mapping","A5_basin_tus","A5_gercek_karar",
      "A6_sira","A6_mapping","A6_basin_tus","A6_gercek_karar",
    ]);
  }

  const k   = d.kimlik           || {};
  const gt  = d.gges_turk        || {};
  const gto = d.gges_turkolmayan || {};

  const aktor = {};
  (d.aktor || []).forEach(a => { aktor[a.senaryo_id] = a; });

  function ac(id, alan) { return aktor[id] ? aktor[id][alan] : ""; }

  sheet.appendRow([
    d.zaman, d.tarayici,
    d.takma_isim, d.yas, d.cinsiyet, d.gelir, d.din, d.dindarlik,
    d.siyasi_konum, d.siyasi_baglilik,
    k.kimlik_1, k.kimlik_2, k.kimlik_3, k.kimlik_4, k.kimlik_5, k.kimlik_6, k.kimlik_7,
    gt.gges_turk_gges_1, gt.gges_turk_gges_2, gt.gges_turk_gges_3, gt.gges_turk_gges_4,
    gt.gges_turk_gges_5, gt.gges_turk_gges_6, gt.gges_turk_gges_7, gt.gges_turk_gges_8,
    gto.gges_to_gges_1, gto.gges_to_gges_2, gto.gges_to_gges_3, gto.gges_to_gges_4,
    gto.gges_to_gges_5, gto.gges_to_gges_6, gto.gges_to_gges_7, gto.gges_to_gges_8,
    (d.aktor_sirasi || []).join("-"),
    ac("A1","gosterim_sirasi"), ac("A1","mapping"), ac("A1","basin_tus"), ac("A1","gercek_karar"),
    ac("A2","gosterim_sirasi"), ac("A2","mapping"), ac("A2","basin_tus"), ac("A2","gercek_karar"),
    ac("A3","gosterim_sirasi"), ac("A3","mapping"), ac("A3","basin_tus"), ac("A3","gercek_karar"),
    ac("A4","gosterim_sirasi"), ac("A4","mapping"), ac("A4","basin_tus"), ac("A4","gercek_karar"),
    ac("A5","gosterim_sirasi"), ac("A5","mapping"), ac("A5","basin_tus"), ac("A5","gercek_karar"),
    ac("A6","gosterim_sirasi"), ac("A6","mapping"), ac("A6","basin_tus"), ac("A6","gercek_karar"),
  ]);

  return ContentService
    .createTextOutput(JSON.stringify({durum:"OK"}))
    .setMimeType(ContentService.MimeType.JSON);
}

================================================================
*/
</script>
</body>
</html>
