<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Trolley Dilemma Deneyi</title>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f0f2f5; color: #222;
      min-height: 100vh; display: flex;
      align-items: center; justify-content: center; padding: 20px;
    }
    .ekran {
      display: none; background: #fff; border-radius: 12px;
      box-shadow: 0 4px 24px rgba(0,0,0,0.10);
      padding: 40px 48px; max-width: 820px; width: 100%;
    }
    .ekran.aktif { display: block; }

    #ekran-fixation,
    #ekran-bystander-once, #ekran-bystander-sonra,
    #ekran-ss-once, #ekran-ss-sonra-dk, #ekran-ss-sonra-likert {
      min-height: 640px; display: none; flex-direction: column;
    }
    #ekran-fixation.aktif,
    #ekran-bystander-once.aktif, #ekran-bystander-sonra.aktif,
    #ekran-ss-once.aktif, #ekran-ss-sonra-dk.aktif, #ekran-ss-sonra-likert.aktif {
      display: flex;
    }

    .gorsel-sahne {
      flex: 1; display: flex; align-items: center; justify-content: center;
      margin-bottom: 16px; min-height: 380px;
    }
    .gorsel-sahne img {
      max-width: 100%; max-height: 380px;
      border-radius: 10px; border: 2px solid #e5e7eb;
      object-fit: contain; transition: opacity 0.15s ease;
    }
    .gorsel-sahne img.gecis { opacity: 0; }
    #ekran-aktor .gorsel-sahne { flex: none; min-height: auto; margin-bottom: 24px; }
    #ekran-aktor .gorsel-sahne img { max-height: 420px; }

    .fixation-cross {
      font-size: 6rem; font-weight: 200; color: #1a1a2e;
      line-height: 1; user-select: none;
    }

    h1 { font-size:1.8rem; margin-bottom:12px; color:#1a1a2e; }
    h2 { font-size:1.3rem; margin-bottom:20px; color:#16213e; }
    p  { line-height:1.7; margin-bottom:12px; color:#444; }
    .bilgi-kutusu { background:#eef2ff; border-left:4px solid #4f46e5; border-radius:6px; padding:14px 18px; margin-bottom:20px; font-size:0.95rem; }
    .btn { display:inline-block; padding:12px 28px; border:none; border-radius:8px; font-size:1rem; cursor:pointer; transition:background 0.2s,transform 0.1s; }
    .btn:active { transform:scale(0.97); }
    .btn-primary { background:#4f46e5; color:#fff; }
    .btn-primary:hover { background:#4338ca; }
    .btn-gray { background:#e5e7eb; color:#333; }
    .btn-gray:hover { background:#d1d5db; }
    .btn-satir { margin-top:28px; display:flex; gap:12px; justify-content:flex-end; flex-wrap:wrap; }
    .form-grup { margin-bottom:22px; }
    .form-grup label { display:block; font-weight:600; margin-bottom:8px; font-size:0.95rem; }
    .form-grup input[type="text"], .form-grup input[type="number"], .form-grup select {
      width:100%; padding:10px 14px; border:1.5px solid #d1d5db;
      border-radius:7px; font-size:0.95rem; outline:none; transition:border 0.2s;
    }
    .form-grup input:focus, .form-grup select:focus { border-color:#4f46e5; }
    .likert-grup { margin-bottom:26px; }
    .likert-grup .soru-metni { font-size:0.95rem; margin-bottom:10px; font-weight:500; }
    .likert-secenekler { display:flex; gap:6px; align-items:center; flex-wrap:nowrap; }
    .likert-secenekler .uc-label { font-size:0.72rem; color:#777; white-space:nowrap; }
    .likert-secenekler .radio-grup { display:flex; gap:4px; flex:1; justify-content:center; }
    .likert-secenekler input[type="radio"] { display:none; }
    .likert-secenekler label.radio-label {
      width:34px; height:34px; border:2px solid #d1d5db; border-radius:50%;
      display:flex; align-items:center; justify-content:center;
      font-size:0.82rem; font-weight:700; cursor:pointer; transition:all 0.15s; color:#555; flex-shrink:0;
    }
    .likert-secenekler input[type="radio"]:checked + label.radio-label { background:#4f46e5; border-color:#4f46e5; color:#fff; }
    .likert-secenekler label.radio-label:hover { border-color:#4f46e5; color:#4f46e5; }
    .bolum-bant { background:#1a1a2e; color:#fff; border-radius:8px; padding:12px 20px; margin-bottom:24px; display:flex; align-items:center; gap:12px; flex-shrink:0; }
    .bolum-bant .bolum-no { background:#4f46e5; border-radius:50%; width:32px; height:32px; display:flex; align-items:center; justify-content:center; font-weight:800; font-size:0.95rem; flex-shrink:0; }
    .hata { color:#dc2626; font-size:0.85rem; margin-top:6px; display:none; }
    .spinner { width:48px; height:48px; border:5px solid #e5e7eb; border-top-color:#4f46e5; border-radius:50%; animation:spin 0.9s linear infinite; margin:20px auto; }
    @keyframes spin { to { transform:rotate(360deg); } }
    @media (max-width:600px) { .ekran { padding:24px 18px; } .likert-secenekler { flex-wrap:wrap; } }
    .gges-madde { display:flex; align-items:center; gap:16px; padding:14px 0; border-bottom:1px solid #f3f4f6; }
    .gges-madde:last-child { border-bottom:none; }
    .gges-sifat { font-weight:700; font-size:1rem; color:#1a1a2e; min-width:100px; flex-shrink:0; }
    .gges-secenekler { display:flex; flex-wrap:nowrap; gap:6px; flex:1; }
    .gges-radio-label { display:flex; align-items:center; gap:4px; cursor:pointer; padding:6px 10px; border:2px solid #d1d5db; border-radius:8px; font-size:0.78rem; color:#444; transition:all 0.15s; background:#fff; user-select:none; white-space:nowrap; flex:1; justify-content:center; }
    .gges-radio-label input[type="radio"] { display:none; }
    .gges-radio-label:hover { border-color:#4f46e5; color:#4f46e5; background:#eef2ff; }
    .gges-radio-label:has(input:checked) { border-color:#4f46e5; background:#4f46e5; color:#fff; }
    @media (max-width:700px) { .gges-madde { flex-direction:column; align-items:flex-start; } .gges-secenekler { flex-wrap:wrap; } }
    .ilerleme-kap { background:#e5e7eb; border-radius:999px; height:8px; margin-bottom:8px; overflow:hidden; flex-shrink:0; }
    .ilerleme-ic { background:#4f46e5; height:100%; border-radius:999px; transition:width 0.4s ease; }
    .ilerleme-metin { font-size:0.82rem; color:#888; text-align:right; margin-bottom:12px; flex-shrink:0; }
    .tus-alani { display:flex; gap:16px; justify-content:center; margin:20px 0; flex-shrink:0; }
    .tus-kutu { border:3px solid #d1d5db; border-radius:12px; padding:20px 40px; text-align:center; min-width:160px; user-select:none; pointer-events:none; }
    .tus-kutu.secildi { border-color:#4f46e5; background:#eef2ff; }
    .tus-harf { font-size:2.2rem; font-weight:900; display:block; margin-bottom:6px; color:#1a1a2e; }
    .tus-aciklama { font-size:0.9rem; color:#555; font-weight:600; }
    .klavye-ipucu { text-align:center; font-size:0.82rem; color:#aaa; margin-top:8px; flex-shrink:0; }
    .bys-soru { font-size:1rem; font-weight:600; color:#1a1a2e; margin-bottom:20px; text-align:center; flex-shrink:0; }
    .bys-likert-dis { pointer-events:none; user-select:none; display:flex; justify-content:center; flex-shrink:0; }
    .bys-likert-ic { display:inline-flex; flex-direction:column; align-items:stretch; gap:8px; }
    .bys-sayilar-satir { display:flex; align-items:center; gap:12px; }
    .bys-numara { width:52px; height:52px; border:3px solid #d1d5db; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:1.1rem; font-weight:800; color:#555; transition:all 0.15s; flex-shrink:0; }
    .bys-numara.secildi { background:#4f46e5; border-color:#4f46e5; color:#fff; }
    .bys-etiket-satir { display:flex; justify-content:space-between; font-size:0.72rem; color:#888; }
    .bys-klavye-ipucu { text-align:center; font-size:0.82rem; color:#aaa; margin-top:12px; flex-shrink:0; }
  </style>
</head>
<body>

<!-- FIXATION — kart içinde -->
<section id="ekran-fixation" class="ekran">
  <div class="bolum-bant">
    <div class="bolum-no" id="fix-bolum-no">5</div>
    <div id="fix-bolum-baslik">Senaryolar</div>
  </div>
  <div class="ilerleme-metin" id="fix-ilerleme-metin"></div>
  <div class="ilerleme-kap"><div class="ilerleme-ic" id="fix-ilerleme-ic" style="width:0%"></div></div>
  <div class="gorsel-sahne">
    <span class="fixation-cross">+</span>
  </div>
</section>

<!-- EKRAN 0: ONAM FORMU -->
<section id="ekran-hosgeldin" class="ekran aktif">
  <h1 style="font-size:1.35rem; margin-bottom:6px;">Bilgilendirilmiş Onam Formu</h1>
  <p style="font-size:0.82rem; color:#888; margin-bottom:20px;">Gruplar arası Dinamiklerde Ahlaki Karar Verme ve Öz Fedakarlığın Nöral Korelasyonlarının Araştırılması: Bir ERP Çalışması</p>
  <p>Dr. Öğretim Üyesi <strong>Esin Tuna Demircioğlu</strong> danışmanlığında, Yeditepe Üniversitesi Bilişsel Bilimler Yüksek Lisans programı öğrencisi <strong>Fatih Selçuk</strong> tarafından yürütülen bu tez çalışmasının ikinci deneysel çalışmasına davet edildiniz.</p>
  <p>Araştırmanın amacı, bireylerin öz-kimliklerinin grup kimlikleriyle etkileşimi üzerinden ahlaki kararlarını incelemektir. Araştırmanın tahmini süresi <strong>10 dakikadır</strong>. Bu çalışmaya katılım tamamen gönüllülük esasına dayanmaktadır.</p>
  <p>Deneyde monitör aracılığıyla ekranda tramvay ikilemi senaryoları izleyecek ve ahlaki kararlar vereceksiniz. Öncelikle <strong>Aktör</strong> olacak ve ikilemlerin çözümüne dair kendi ahlaki kararınızı vermeniz beklenecek, sonrasında ise <strong>Seyirci</strong> senaryoları gösterilecek ve yaşanan durumun ne kadar ahlaki olup olmadığına dair geri bildirim vermeniz istenecektir. Bu esnada beyin elektriksel aktiviteniz kayıt altına alınacaktır; ancak bu kayıtlar yalnızca mevcut araştırma için kullanılacaktır.</p>
  <p>Size ait tüm bilgiler saklı tutulacak, yayın, raporlama ve analiz bölümlerinde kimlik bilgileriniz kullanılmayacaktır. Katılımınız esnasında kendinizi rahatsız hissederseniz, deneyi istediğiniz an sonlandırmakta serbestsiniz.</p>
  <p>Çalışma hakkında bilgi almak için:<br>
  Dr. Öğr. Üyesi Esin Tuna Demircioğlu — <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="dbbea8b2b5afaeb5baea9bbcb6bab2b7f5b8b4b6">[email&#160;protected]</a><br>
  Fatih Selçuk — <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="f69085939a95839dc3b6919b979f9ad895999b">[email&#160;protected]</a> · 0537 686 34 02</p>
  <div class="bilgi-kutusu" style="margin-top:20px; font-size:0.9rem;">
    Bilgilendirilmiş gönüllü onam formundaki tüm açıklamaları okudum. Araştırmaya gönüllü olarak katıldığımı, istediğim zaman gerekçeli veya gerekçesiz olarak araştırmadan ayrılabileceğimi biliyorum. Söz konusu araştırmaya hiçbir baskı ve zorlama olmaksızın kendi rızamla katılmayı kabul ettiğimi bildiririm.
  </div>
  <div class="btn-satir">
    <button class="btn btn-primary" onclick="ekranGec('ekran-demografik')">Okudum, kabul ediyorum →</button>
  </div>
</section>

<!-- EKRAN 1: DEMOGRAFİK -->
<section id="ekran-demografik" class="ekran">
  <div class="bolum-bant"><div class="bolum-no">1</div><div>Demografik Bilgiler</div></div>
  <div class="form-grup"><label>1. Bir takma isim giriniz</label><input type="text" id="dem-takma-isim" placeholder="Takma isminizi yazın" /></div>
  <div class="form-grup"><label>2. Yaşınız</label><input type="number" id="dem-yas" min="18" max="99" placeholder="Örn: 24" /></div>
  <div class="form-grup"><label>3. Cinsiyetiniz</label>
    <select id="dem-cinsiyet"><option value="">-- Seçiniz --</option><option>Erkek</option><option>Kadın</option><option>Belirtmek istemiyorum</option></select>
  </div>
  <div class="form-grup"><label>4. Gelir Durumunuz</label>
    <select id="dem-gelir"><option value="">-- Seçiniz --</option><option>0 - 17.000 ₺</option><option>17.000 - 35.000 ₺</option><option>35.000 - 57.000 ₺</option><option>57.000 ₺ ve üstü</option></select>
  </div>
  <div class="form-grup"><label>5. Dini İnancınız</label>
    <select id="dem-din"><option value="">-- Seçiniz --</option><option>Hristiyan</option><option>Budist</option><option>Hindu</option><option>Müslüman</option><option>Yahudi</option><option>Ateist</option><option>Deist</option><option>Agnostik</option><option>Diğer</option></select>
  </div>
  <div class="form-grup"><label>6. Kendinizi hangi düzeyde dindar olarak görüyorsunuz?</label>
    <select id="dem-dindarlik"><option value="">-- Seçiniz --</option><option>Dindar değilim</option><option>Biraz dindarım</option><option>Orta derecede dindarım</option><option>Çok dindarım</option><option>Bilmiyorum</option></select>
  </div>
  <div class="form-grup">
    <label>7. Siyasi açıdan Türkiye'de yıllardır sol, sağ ve merkez diye bir siyasi gelenek vardır. Siz kendinizi aşağıdaki ölçekte hangi konumda görüyorsunuz?</label>
    <div class="likert-grup" style="margin-top:10px;">
      <div class="likert-secenekler">
        <span class="uc-label">Aşırı Sol</span>
        <div class="radio-grup" id="dem-siyasi-konum-rg"></div>
        <span class="uc-label">Aşırı Sağ</span>
      </div>
    </div>
  </div>
  <div class="form-grup"><label>8. Kendinizi siyasi görüşünüze hangi düzeyde bağlı olarak görüyorsunuz?</label>
    <select id="dem-siyasi-baglilik"><option value="">-- Seçiniz --</option><option>Hiç bağlı değilim</option><option>Az bağlıyım</option><option>Orta düzeyde bağlıyım</option><option>Oldukça bağlıyım</option><option>Tamamen bağlıyım</option></select>
  </div>
  <div id="dem-hata" class="hata">Lütfen tüm alanları doldurun.</div>
  <div class="btn-satir">
    <button class="btn btn-gray" onclick="ekranGec('ekran-hosgeldin')">← Geri</button>
    <button class="btn btn-primary" onclick="demografikDogrula()">Devam →</button>
  </div>
</section>

<!-- EKRAN 2a: KİMLİK AÇIKLAMA -->
<section id="ekran-kimlik-aciklama" class="ekran">
  <div class="bolum-bant"><div class="bolum-no">2</div><div>Kimlik Kaynaşım Ölçeği</div></div>
  <p>Birazdan göreceğiniz soruların doğru cevabı yoktur. Lütfen ekranda göreceğiniz soruları kendi bakış açınıza göre mümkün olduğunca objektif bir biçimde cevaplayınız.</p>
  <p style="margin-top:16px; font-weight:600; font-size:1.05rem; color:#1a1a2e;">Bağlı bulunduğunuz grubu Türklük üzerinden tanımladığınızda;</p>
  <div class="btn-satir">
    <button class="btn btn-gray" onclick="ekranGec('ekran-demografik')">← Geri</button>
    <button class="btn btn-primary" onclick="ekranGec('ekran-kimlik')">Devam →</button>
  </div>
</section>

<!-- EKRAN 2b: KİMLİK -->
<section id="ekran-kimlik" class="ekran">
  <div class="bolum-bant"><div class="bolum-no">2</div><div>Kimlik Kaynaşım Ölçeği</div></div>
  <p class="bilgi-kutusu">Aşağıdaki ifadelerin sizin için ne kadar doğru olduğunu 1 (Kesinlikle Katılmıyorum) ile 7 (Kesinlikle Katılıyorum) arasında değerlendirin.</p>
  <div id="kimlik-sorular"></div>
  <div id="kimlik-hata" class="hata">Lütfen tüm soruları yanıtlayın.</div>
  <div class="btn-satir">
    <button class="btn btn-gray" onclick="ekranGec('ekran-kimlik-aciklama')">← Geri</button>
    <button class="btn btn-primary" onclick="kimlikDogrula()">Devam →</button>
  </div>
</section>

<!-- EKRAN 3a: GGES AÇIKLAMA -->
<section id="ekran-gges-aciklama" class="ekran">
  <div class="bolum-bant"><div class="bolum-no">3</div><div>GGES Ölçeği</div></div>
  <p>Aşağıda Türk ve Türk olmayan insanlarla ilgili birtakım sıfatlar yer almaktadır.</p>
  <p style="margin-top:12px;">Soruların doğru veya yanlış cevabı yoktur, bizim için önemli olan sizin ne düşündüğünüzdür.</p>
  <p style="margin-top:12px;">Lütfen <strong>1 (Hiç tanımlamıyor)</strong> ile <strong>5 (Tamamen tanımlıyor)</strong> arasında her sıfatın <strong>Türk</strong> ve <strong>Türk olmayan</strong> grubu ne kadar iyi tanımladığını işaretleyiniz.</p>
  <div class="btn-satir">
    <button class="btn btn-gray" onclick="ekranGec('ekran-kimlik')">← Geri</button>
    <button class="btn btn-primary" onclick="ekranGec('ekran-gges-turk')">Devam →</button>
  </div>
</section>

<!-- EKRAN 3b: GGES TÜRK -->
<section id="ekran-gges-turk" class="ekran">
  <div class="bolum-bant"><div class="bolum-no">3</div><div>GGES Ölçeği – Türk Gruplar</div></div>
  <p class="bilgi-kutusu">1 = Hiç tanımlamıyor &nbsp;·&nbsp; 5 = Tamamen tanımlıyor</p>
  <p style="margin-bottom:20px; font-weight:600; font-size:1.05rem; color:#1a1a2e;">Türk gruplar için;</p>
  <div id="gges-turk-sorular"></div>
  <div id="gges-turk-hata" class="hata">Lütfen tüm soruları yanıtlayın.</div>
  <div class="btn-satir">
    <button class="btn btn-gray" onclick="ekranGec('ekran-gges-aciklama')">← Geri</button>
    <button class="btn btn-primary" onclick="ggesTogrula()">Devam →</button>
  </div>
</section>

<!-- EKRAN 3c: GGES TÜRK OLMAYAN -->
<section id="ekran-gges-to" class="ekran">
  <div class="bolum-bant"><div class="bolum-no">3</div><div>GGES Ölçeği – Türk Olmayan Gruplar</div></div>
  <p class="bilgi-kutusu">1 = Hiç tanımlamıyor &nbsp;·&nbsp; 5 = Tamamen tanımlıyor</p>
  <p style="margin-bottom:20px; font-weight:600; font-size:1.05rem; color:#1a1a2e;">Türk olmayan gruplar için;</p>
  <div id="gges-to-sorular"></div>
  <div id="gges-to-hata" class="hata">Lütfen tüm soruları yanıtlayın.</div>
  <div class="btn-satir">
    <button class="btn btn-gray" onclick="ekranGec('ekran-gges-turk')">← Geri</button>
    <button class="btn btn-primary" onclick="ggesToOgrula()">Devam →</button>
  </div>
</section>

<!-- EKRAN 4a: AKTÖR AÇIKLAMA -->
<section id="ekran-aktor-aciklama" class="ekran">
  <div class="bolum-bant"><div class="bolum-no">4</div><div>Aktör Senaryoları</div></div>
  <p>Birazdan size bir dizi tramvay ikilemi senaryosu gösterilecektir. Her senaryoda bir karar vermeniz gerekecektir. Bu bölümde kararları siz almaktasınız.</p>
  <p style="margin-top:12px;">Tren raylarında Türk ve Türk olmayan bireyler durmaktadır. Eğer trenin yönünü değiştirecek kolu çekmezseniz trenin doğrultusundaki kişiler ölecektir. Eğer çekerseniz treni yan raya doğru kaydıracak ve trenin doğrultusundaki rayda bulunan kişileri kurtarmış olacaksınız.</p>
  <p style="margin-top:12px;">Karar almak için klavyede bulunan <strong>D</strong> ve <strong>K</strong> tuşlarını kullanabilirsiniz.</p>
  <div class="btn-satir">
    <button class="btn btn-gray" onclick="ekranGec('ekran-gges-to')">← Geri</button>
    <button class="btn btn-primary" onclick="aktorBaslat()">Başla →</button>
  </div>
</section>

<!-- EKRAN 4b: AKTÖR -->
<section id="ekran-aktor" class="ekran">
  <div class="bolum-bant"><div class="bolum-no">4</div><div>Aktör Senaryoları</div></div>
  <div class="ilerleme-metin" id="aktor-ilerleme-metin"></div>
  <div class="ilerleme-kap"><div class="ilerleme-ic" id="aktor-ilerleme-ic" style="width:0%"></div></div>
  <div class="gorsel-sahne"><img id="aktor-gorsel" src="" alt="Senaryo görseli" /></div>
  <div class="tus-alani">
    <div class="tus-kutu" id="tus-d"><span class="tus-harf">D</span><span class="tus-aciklama" id="tus-d-label">Çekerim</span></div>
    <div class="tus-kutu" id="tus-k"><span class="tus-harf">K</span><span class="tus-aciklama" id="tus-k-label">Çekmem</span></div>
  </div>
  <p class="klavye-ipucu">Yalnızca klavye ile D veya K tuşuna basın.</p>
</section>

<!-- EKRAN 5a: BYSTANDER AÇIKLAMA -->
<section id="ekran-bystander-aciklama" class="ekran">
  <div class="bolum-bant"><div class="bolum-no">5</div><div>Bystander Senaryoları</div></div>
  <p>Birazdan size bir dizi tramvay ikilemi senaryosu tekrardan gösterilecektir. Bu senaryolarda bir karar alıcı vardır ve siz yalnızca verilen karara şahit olmaktasınız.</p>
  <p style="margin-top:12px;">Senaryolar sizlere iki parça halinde sunulacaktır: <strong>Öncesi</strong> ve <strong>Sonrası</strong> olarak. Senaryonun öncesinde tren raylarında bulunan kişilerin Türk veya Türk olmadığını göreceksiniz. Sonrasında ise senaryodaki kişinin kararına şahit olacaksınız.</p>
  <p style="margin-top:12px;">Sizden istenen senaryoda yer alan karar vericinin kararını ne kadar ahlaki bulduğunu puanlamanızdır. Değerlendirmenizi klavyede bulunan <strong>1–6</strong> tuşları ile yapınız. <strong>1</strong> Hiç ahlaki değil, <strong>6</strong> Tamamen ahlaki şeklinde.</p>
  <div class="btn-satir">
    <button class="btn btn-gray" onclick="ekranGec('ekran-aktor-aciklama')">← Geri</button>
    <button class="btn btn-primary" onclick="bystanderBaslat()">Başla →</button>
  </div>
</section>

<!-- EKRAN 5b: BYSTANDER ÖNCESİ -->
<section id="ekran-bystander-once" class="ekran">
  <div class="bolum-bant"><div class="bolum-no">5</div><div>Bystander Senaryoları</div></div>
  <div class="ilerleme-metin" id="bys-ilerleme-metin"></div>
  <div class="ilerleme-kap"><div class="ilerleme-ic" id="bys-ilerleme-ic" style="width:0%"></div></div>
  <div class="gorsel-sahne"><img id="bys-gorsel-once" src="" alt="Senaryo öncesi" /></div>
</section>

<!-- EKRAN 5c: BYSTANDER SONRASI -->
<section id="ekran-bystander-sonra" class="ekran">
  <div class="bolum-bant"><div class="bolum-no">5</div><div>Bystander Senaryoları</div></div>
  <div class="gorsel-sahne"><img id="bys-gorsel-sonra" src="" alt="Senaryo sonrası" /></div>
  <p class="bys-soru">Bu senaryoda verilen kararı ne kadar ahlaki buldunuz?</p>
  <div class="bys-likert-dis">
    <div class="bys-likert-ic">
      <div class="bys-sayilar-satir">
        <div class="bys-numara" id="bys-n-1">1</div><div class="bys-numara" id="bys-n-2">2</div>
        <div class="bys-numara" id="bys-n-3">3</div><div class="bys-numara" id="bys-n-4">4</div>
        <div class="bys-numara" id="bys-n-5">5</div><div class="bys-numara" id="bys-n-6">6</div>
      </div>
      <div class="bys-etiket-satir"><span>Hiç ahlaki değil</span><span>Tamamen ahlaki</span></div>
    </div>
  </div>
  <p class="bys-klavye-ipucu">Klavyeden 1, 2, 3, 4, 5 veya 6 tuşuna basın.</p>
</section>

<!-- EKRAN 6a: SS AKTÖR AÇIKLAMA -->
<section id="ekran-ss-aktor-aciklama" class="ekran">
  <div class="bolum-bant"><div class="bolum-no">6</div><div>SS Senaryoları – Bölüm 1</div></div>
  <p>Birazdan size bir dizi tramvay ikilemi senaryosu tekrardan gösterilecektir. Bu senaryoların ilk ikisi <strong>D</strong> ve <strong>K</strong> tuşları ile cevaplanacaktır.</p>
  <p style="margin-top:12px;">İlk bölümde tren raylarında yine Türk veya Türk olmayan katılımcılar göreceksiniz. Siz ise bir yaya köprüsünün üzerinde olacaksınız. Eğer yaya köprüsünden atlarsanız tramvay duracak ve rayların üzerinde bulunan kişiler kurtulacaktır.</p>
  <div class="tus-alani" style="pointer-events:none; margin-top:16px;">
    <div class="tus-kutu"><span class="tus-harf">D</span><span class="tus-aciklama">Atlarım</span></div>
    <div class="tus-kutu"><span class="tus-harf">K</span><span class="tus-aciklama">Atlamam</span></div>
  </div>
  <div class="btn-satir">
    <button class="btn btn-gray" onclick="ekranGec('ekran-bystander-aciklama')">← Geri</button>
    <button class="btn btn-primary" onclick="ssBaslat()">Başla →</button>
  </div>
</section>

<!-- EKRAN 6b: SS BYSTANDER AÇIKLAMA -->
<section id="ekran-ss-bystander-aciklama" class="ekran">
  <div class="bolum-bant"><div class="bolum-no">6</div><div>SS Senaryoları – Bölüm 2</div></div>
  <p>Birazdan size bir dizi tramvay ikilemi senaryosu tekrardan gösterilecektir. Bu senaryolar senaryoda yer alan kişinin kararları neticesinde sonuçlanacaktır. Bu senaryolar klavyede yer alan <strong>1–6</strong> tuşları ile cevaplanmalıdır.</p>
  <p style="margin-top:12px;">Senaryoda yer alan kişi yaya köprüsünün üzerindedir. Eğer raylara atlarsa tren raylarında bulunan kişiler kurtulacaktır. Atlamadıkları takdirde tramvay tren rayları üzerindeki herkesi ezecektir.</p>
  <p style="margin-top:12px;">Sizden istenen senaryodaki kişinin tercihini ahlaki olarak puanlamanızdır.</p>
  <div class="bys-likert-dis" style="margin-top:16px; margin-bottom:4px;">
    <div class="bys-likert-ic">
      <div class="bys-sayilar-satir">
        <div class="bys-numara">1</div><div class="bys-numara">2</div><div class="bys-numara">3</div>
        <div class="bys-numara">4</div><div class="bys-numara">5</div><div class="bys-numara">6</div>
      </div>
      <div class="bys-etiket-satir"><span>Hiç ahlaki değil</span><span>Tamamen ahlaki</span></div>
    </div>
  </div>
  <div class="btn-satir">
    <button class="btn btn-gray" onclick="ekranGec('ekran-ss-aktor-aciklama')">← Geri</button>
    <button class="btn btn-primary" onclick="ssBystanderBaslat()">Senaryolara Başla →</button>
  </div>
</section>

<!-- EKRAN 6c: SS ÖNCESİ -->
<section id="ekran-ss-once" class="ekran">
  <div class="bolum-bant"><div class="bolum-no">6</div><div>SS Senaryoları</div></div>
  <div class="ilerleme-metin" id="ss-ilerleme-metin"></div>
  <div class="ilerleme-kap"><div class="ilerleme-ic" id="ss-ilerleme-ic" style="width:0%"></div></div>
  <div class="gorsel-sahne"><img id="ss-gorsel-once" src="" alt="Senaryo öncesi" /></div>
</section>

<!-- EKRAN 6d: SS SONRASI D/K -->
<section id="ekran-ss-sonra-dk" class="ekran">
  <div class="bolum-bant"><div class="bolum-no">6</div><div>SS Senaryoları</div></div>
  <div class="gorsel-sahne"><img id="ss-gorsel-sonra-dk" src="" alt="Senaryo sonrası" /></div>
  <div class="tus-alani">
    <div class="tus-kutu" id="ss-tus-d"><span class="tus-harf">D</span><span class="tus-aciklama">Atlarım</span></div>
    <div class="tus-kutu" id="ss-tus-k"><span class="tus-harf">K</span><span class="tus-aciklama">Atlamam</span></div>
  </div>
  <p class="klavye-ipucu">Yalnızca klavye ile D veya K tuşuna basın.</p>
</section>

<!-- EKRAN 6e: SS SONRASI LİKERT -->
<section id="ekran-ss-sonra-likert" class="ekran">
  <div class="bolum-bant"><div class="bolum-no">6</div><div>SS Senaryoları</div></div>
  <div class="gorsel-sahne"><img id="ss-gorsel-sonra-likert" src="" alt="Senaryo sonrası" /></div>
  <p class="bys-soru">Bu senaryoda verilen kararı ne kadar ahlaki buldunuz?</p>
  <div class="bys-likert-dis">
    <div class="bys-likert-ic">
      <div class="bys-sayilar-satir">
        <div class="bys-numara" id="ss-n-1">1</div><div class="bys-numara" id="ss-n-2">2</div>
        <div class="bys-numara" id="ss-n-3">3</div><div class="bys-numara" id="ss-n-4">4</div>
        <div class="bys-numara" id="ss-n-5">5</div><div class="bys-numara" id="ss-n-6">6</div>
      </div>
      <div class="bys-etiket-satir"><span>Hiç ahlaki değil</span><span>Tamamen ahlaki</span></div>
    </div>
  </div>
  <p class="bys-klavye-ipucu">Klavyeden 1, 2, 3, 4, 5 veya 6 tuşuna basın.</p>
</section>

<!-- GÖNDERİM -->
<section id="ekran-gonderim" class="ekran">
  <h2 style="text-align:center;">Verileriniz gönderiliyor…</h2>
  <div class="spinner"></div>
  <p style="text-align:center; color:#555;">Lütfen bu sayfayı kapatmayın.</p>
</section>

<!-- BİTİŞ -->
<section id="ekran-bitis" class="ekran">
  <h1>Teşekkürler!</h1>
  <p>Katılımınız için teşekkür ederiz. Yanıtlarınız başarıyla kaydedildi.</p>
</section>

<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
var GOOGLE_SCRIPT_URL   = "https://script.google.com/macros/s/BURAYA_URL_GIRIN/exec";
var AKTOR_SURE          = 8;
var BYSTANDER_ONCE_SURE = 4000;
var SS_ONCE_SURE        = 4000;
var SS_DK_SURE          = 8;
var FIXATION_SURE       = 250;

var KIMLIK_SORULARI = [
  { id:"kimlik_1", metin:"Grubumla bir bütünüm." },
  { id:"kimlik_2", metin:"Grubumla bütünleşmiş hissediyorum." },
  { id:"kimlik_3", metin:"Grubumla aramda derin bir duygusal bağım var." },
  { id:"kimlik_4", metin:"Grubum ben demektir." },
  { id:"kimlik_5", metin:"Grubum için diğer grup üyelerinin yapacağından daha fazlasını yaparım." },
  { id:"kimlik_6", metin:"Grubum sayesinde güçlüyüm." },
  { id:"kimlik_7", metin:"Bağlı bulunduğum grubu güçlü hale getiriyorum." }
];
var GGES_SORULARI = [
  { id:"gges_1", metin:"İyi" },{ id:"gges_2", metin:"Nazik" },
  { id:"gges_3", metin:"Dürüst" },{ id:"gges_4", metin:"Güvenilir" },
  { id:"gges_5", metin:"Aksi" },{ id:"gges_6", metin:"Kaba" },
  { id:"gges_7", metin:"Güvenilmez" },{ id:"gges_8", metin:"Kötü" }
];
var AKTOR_SENARYOLARI = [
  { id:"A1", gorsel:"Aktorsenaryo1.png", mapping:"DK" },
  { id:"A2", gorsel:"Aktorsenaryo2.png", mapping:"DK" },
  { id:"A3", gorsel:"Aktorsenaryo3.png", mapping:"DK" },
  { id:"A4", gorsel:"Aktorsenaryo4.png", mapping:"KD" },
  { id:"A5", gorsel:"Aktorsenaryo5.png", mapping:"KD" },
  { id:"A6", gorsel:"Aktorsenaryo6.png", mapping:"KD" }
];
var BYSTANDER_SENARYOLARI = [
  { id:"B1",  once:"Bystandergorsel1.png",  sonra:"Bystandergorsel1_1.png"   },
  { id:"B2",  once:"Bystandergorsel2.png",  sonra:"Bystandergorsel2_2.png"   },
  { id:"B3",  once:"Bystandergorsel3.png",  sonra:"Bystandergorsel3_3.png"   },
  { id:"B4",  once:"Bystandergorsel4.png",  sonra:"Bystandergorsel4_4.png"   },
  { id:"B5",  once:"Bystandergorsel5.png",  sonra:"Bystandergorsel5_5.png"   },
  { id:"B6",  once:"Bystandergorsel6.png",  sonra:"Bystandergorsel6_6.png"   },
  { id:"B7",  once:"Bystandergorsel7.png",  sonra:"Bystandergorsel7_7.png"   },
  { id:"B8",  once:"Bystandergorsel8.png",  sonra:"Bystandergorsel8_8.png"   },
  { id:"B9",  once:"Bystandergorsel9.png",  sonra:"Bystandergorsel9_9.png"   },
  { id:"B10", once:"Bystandergorsel10.png", sonra:"Bystandergorsel10_10.png" },
  { id:"B11", once:"Bystandergorsel11.png", sonra:"Bystandergorsel11_11.png" },
  { id:"B12", once:"Bystandergorsel12.png", sonra:"Bystandergorsel12_12.png" }
];
var SS_AKTOR_SENARYOLARI = [
  { id:"SS1", once:"SSsenaryo1.png", sonra:"SSsenaryo1_1.png", tip:"dk" },
  { id:"SS2", once:"SSsenaryo2.png", sonra:"SSsenaryo2_2.png", tip:"dk" }
];
var SS_BYSTANDER_SENARYOLARI = [
  { id:"SS3", once:"SSsenaryo3.png", sonra:"SSsenaryo3_3.png", tip:"likert" },
  { id:"SS4", once:"SSsenaryo4.png", sonra:"SSsenaryo4_4.png", tip:"likert" },
  { id:"SS5", once:"SSsenaryo5.png", sonra:"SSsenaryo5_5.png", tip:"likert" },
  { id:"SS6", once:"SSsenaryo6.png", sonra:"SSsenaryo6_6.png", tip:"likert" }
];

var veri = {};
var aktorSira=[], aktorIndex=0, aktorYanitVerildi=false;
var aktorTimerId=null, aktorBaslangicZamani=0;
var bystanderSira=[], bystanderIndex=0;
var bystanderOncesiAktif=false, bystanderSonrasiAktif=false, bystanderTimerId=null;
var ssAktorSira=[], ssAktorIndex=0;
var ssBystSira=[], ssBystIndex=0;
var ssAktif = 'aktor'; // 'aktor' veya 'bystander'
var ssSira=[], ssIndex=0;
var ssOncesiAktif=false, ssSonrasiAktif=false, ssTimerId=null;
var ssDkYanitVerildi=false, ssDkTimerId=null, ssDkBaslangicZamani=0;

function ekranGec(id) {
  var ekranlar = document.querySelectorAll('.ekran');
  for (var i=0; i<ekranlar.length; i++) ekranlar[i].classList.remove('aktif');
  document.getElementById(id).classList.add('aktif');
  window.scrollTo(0, 0);
}

function fixationGoster(bolumNo, bolumBaslik, ilerlemeMetin, ilerlemePct, sonrakiId, gorselEl, gorselSrc, callback) {
  document.getElementById('fix-bolum-no').textContent      = bolumNo;
  document.getElementById('fix-bolum-baslik').textContent  = bolumBaslik;
  document.getElementById('fix-ilerleme-metin').textContent = ilerlemeMetin;
  document.getElementById('fix-ilerleme-ic').style.width   = ilerlemePct + '%';

  var ekranlar = document.querySelectorAll('.ekran');
  for (var i=0; i<ekranlar.length; i++) ekranlar[i].classList.remove('aktif');
  document.getElementById('ekran-fixation').classList.add('aktif');
  window.scrollTo(0, 0);

  gorselEl.classList.add('gecis');
  gorselEl.src = gorselSrc;

  function doGecis() {
    var ekranlar2 = document.querySelectorAll('.ekran');
    for (var i=0; i<ekranlar2.length; i++) ekranlar2[i].classList.remove('aktif');
    document.getElementById(sonrakiId).classList.add('aktif');
    window.scrollTo(0, 0);
    setTimeout(function() {
      gorselEl.classList.remove('gecis');
      if (callback) callback();
    }, 50);
  }

  if (gorselEl.complete && gorselEl.naturalWidth > 0) {
    setTimeout(doGecis, FIXATION_SURE);
  } else {
    var done = false;
    var tid = setTimeout(function() { if (!done) { done=true; doGecis(); } }, FIXATION_SURE);
    gorselEl.onload = function() { if (!done) { done=true; clearTimeout(tid); doGecis(); } };
  }
}

function karistir(arr) {
  var a = arr.slice();
  for (var i=a.length-1; i>0; i--) {
    var j = Math.floor(Math.random()*(i+1));
    var tmp = a[i]; a[i]=a[j]; a[j]=tmp;
  }
  return a;
}

function likertRadioUret(cid, isim, max) {
  var el = document.getElementById(cid);
  if (!el) return;
  el.innerHTML = '';
  for (var i=1; i<=max; i++) {
    el.innerHTML += '<input type="radio" name="'+isim+'" id="'+isim+'_'+i+'" value="'+i+'"/><label class="radio-label" for="'+isim+'_'+i+'">'+i+'</label>';
  }
}
function likertDegerOku(isim) {
  var s = document.querySelector('input[name="'+isim+'"]:checked');
  return s ? parseInt(s.value) : null;
}
function olcekUret(cid, sorular, max) {
  var el = document.getElementById(cid);
  el.innerHTML = '';
  for (var i=0; i<sorular.length; i++) {
    var s = sorular[i];
    el.innerHTML += '<div class="likert-grup"><div class="soru-metni">'+s.metin+'</div><div class="likert-secenekler"><span class="uc-label">Kesinlikle Katılmıyorum</span><div class="radio-grup" id="rg_'+s.id+'"></div><span class="uc-label">Kesinlikle Katılıyorum</span></div></div>';
    likertRadioUret('rg_'+s.id, s.id, max);
  }
}
function olcekVeriTopla(sorular) {
  var r = {};
  for (var i=0; i<sorular.length; i++) {
    var d = likertDegerOku(sorular[i].id);
    if (d === null) return null;
    r[sorular[i].id] = d;
  }
  return r;
}
function ggesGrupUret(cid, sorular, prefix) {
  var el = document.getElementById(cid);
  el.innerHTML = '';
  var et = [{deger:1,metin:"Hiç tanımlamıyor"},{deger:2,metin:"Tanımlamıyor"},{deger:3,metin:"Kararsızım"},{deger:4,metin:"Tanımlıyor"},{deger:5,metin:"Tamamen tanımlıyor"}];
  for (var i=0; i<sorular.length; i++) {
    var s = sorular[i];
    var r = '';
    for (var j=0; j<et.length; j++) {
      var e = et[j];
      var lid = prefix+'_'+s.id+'_'+e.deger;
      r += '<label class="gges-radio-label" for="'+lid+'"><input type="radio" name="'+prefix+'_'+s.id+'" id="'+lid+'" value="'+e.deger+'"/><span>'+e.metin+'</span></label>';
    }
    el.innerHTML += '<div class="gges-madde"><div class="gges-sifat">'+s.metin+'</div><div class="gges-secenekler">'+r+'</div></div>';
  }
}
function ggesGrupVeriTopla(sorular, prefix) {
  var r = {};
  for (var i=0; i<sorular.length; i++) {
    var v = document.querySelector('input[name="'+prefix+'_'+sorular[i].id+'"]:checked');
    if (!v) return null;
    r[prefix+'_'+sorular[i].id] = parseInt(v.value);
  }
  return r;
}

window.addEventListener('load', function() {
  olcekUret('kimlik-sorular', KIMLIK_SORULARI, 7);
  ggesGrupUret('gges-turk-sorular', GGES_SORULARI, 'gges_turk');
  ggesGrupUret('gges-to-sorular', GGES_SORULARI, 'gges_to');
  var rg = document.getElementById('dem-siyasi-konum-rg');
  rg.innerHTML = '';
  for (var i=1; i<=7; i++) {
    rg.innerHTML += '<input type="radio" name="dem-siyasi-konum" id="siyasi_'+i+'" value="'+i+'"/><label class="radio-label" for="siyasi_'+i+'">'+i+'</label>';
  }
  document.addEventListener('keydown', klavyeDinle);
});

function demografikDogrula() {
  var t  = document.getElementById('dem-takma-isim').value.trim();
  var y  = document.getElementById('dem-yas').value.trim();
  var c  = document.getElementById('dem-cinsiyet').value;
  var g  = document.getElementById('dem-gelir').value;
  var d  = document.getElementById('dem-din').value;
  var dk = document.getElementById('dem-dindarlik').value;
  var sk = likertDegerOku('dem-siyasi-konum');
  var sb = document.getElementById('dem-siyasi-baglilik').value;
  if (!t||!y||!c||!g||!d||!dk||!sk||!sb) { document.getElementById('dem-hata').style.display='block'; return; }
  document.getElementById('dem-hata').style.display='none';
  veri.takma_isim=t; veri.yas=y; veri.cinsiyet=c; veri.gelir=g;
  veri.din=d; veri.dindarlik=dk; veri.siyasi_konum=sk; veri.siyasi_baglilik=sb;
  ekranGec('ekran-kimlik-aciklama');
}
function kimlikDogrula() {
  var s = olcekVeriTopla(KIMLIK_SORULARI);
  if (!s) { document.getElementById('kimlik-hata').style.display='block'; return; }
  document.getElementById('kimlik-hata').style.display='none';
  veri.kimlik = s; ekranGec('ekran-gges-aciklama');
}
function ggesTogrula() {
  var s = ggesGrupVeriTopla(GGES_SORULARI, 'gges_turk');
  if (!s) { document.getElementById('gges-turk-hata').style.display='block'; return; }
  document.getElementById('gges-turk-hata').style.display='none';
  veri.gges_turk = s; ekranGec('ekran-gges-to');
}
function ggesToOgrula() {
  var s = ggesGrupVeriTopla(GGES_SORULARI, 'gges_to');
  if (!s) { document.getElementById('gges-to-hata').style.display='block'; return; }
  document.getElementById('gges-to-hata').style.display='none';
  veri.gges_turkolmayan = s; ekranGec('ekran-aktor-aciklama');
}

function aktorBaslat() {
  aktorSira = karistir(AKTOR_SENARYOLARI); aktorIndex = 0; veri.aktor = [];
  veri.aktor_sirasi = aktorSira.map(function(s){return s.id;});
  ekranGec('ekran-aktor'); aktorGorselGoster();
}
function aktorGorselGoster() {
  aktorYanitVerildi = false;
  var toplam = aktorSira.length, sn = aktorSira[aktorIndex];
  document.getElementById('aktor-ilerleme-metin').textContent = 'Senaryo '+(aktorIndex+1)+' / '+toplam;
  document.getElementById('aktor-ilerleme-ic').style.width = ((aktorIndex/toplam)*100)+'%';
  document.getElementById('aktor-gorsel').src = sn.gorsel;
  document.getElementById('tus-d-label').textContent = sn.mapping==="DK" ? "Çekerim" : "Çekmem";
  document.getElementById('tus-k-label').textContent = sn.mapping==="DK" ? "Çekmem" : "Çekerim";
  document.getElementById('tus-d').className = 'tus-kutu';
  document.getElementById('tus-k').className = 'tus-kutu';
  aktorBaslangicZamani = Date.now();
  aktorTimerId = setTimeout(function(){ aktorKaydetVeGec(null); }, AKTOR_SURE*1000);
}
function aktorKaydetVeGec(basin_tus) {
  clearTimeout(aktorTimerId);
  var sn = aktorSira[aktorIndex];
  var tepki = parseFloat(((Date.now()-aktorBaslangicZamani)/1000).toFixed(3));
  if (basin_tus==='D') document.getElementById('tus-d').className='tus-kutu secildi';
  else if (basin_tus==='K') document.getElementById('tus-k').className='tus-kutu secildi';
  veri.aktor.push({senaryo_id:sn.id, gosterim_sirasi:aktorIndex+1, mapping:sn.mapping,
    basin_tus:basin_tus!==null?basin_tus:"YOK", tepki_suresi:basin_tus!==null?tepki:AKTOR_SURE});
  aktorIndex++;
  setTimeout(function(){
    if (aktorIndex < aktorSira.length) aktorGorselGoster();
    else ekranGec('ekran-bystander-aciklama');
  }, 400);
}

function bystanderBaslat() {
  bystanderSira = karistir(BYSTANDER_SENARYOLARI); bystanderIndex=0; veri.bystander=[];
  veri.bystander_sirasi = bystanderSira.map(function(s){return s.id;});
  bystanderOncesiGoster();
}
function bystanderOncesiGoster() {
  var toplam = bystanderSira.length, sn = bystanderSira[bystanderIndex];
  var metin = 'Senaryo '+(bystanderIndex+1)+' / '+toplam;
  var pct   = (bystanderIndex/toplam)*100;
  document.getElementById('bys-ilerleme-metin').textContent = metin;
  document.getElementById('bys-ilerleme-ic').style.width    = pct+'%';
  document.getElementById('bys-gorsel-once').src = sn.once;
  bystanderOncesiAktif=true; bystanderSonrasiAktif=false;
  ekranGec('ekran-bystander-once');
  var preload = new Image(); preload.src = sn.sonra;
  bystanderTimerId = setTimeout(function(){
    bystanderOncesiAktif = false;
    var sonraImg = document.getElementById('bys-gorsel-sonra');
    fixationGoster(5, 'Bystander Senaryoları', metin, pct, 'ekran-bystander-sonra', sonraImg, sn.sonra, function(){
      for (var i=1; i<=6; i++) document.getElementById('bys-n-'+i).classList.remove('secildi');
      bystanderSonrasiAktif = true;
    });
  }, BYSTANDER_ONCE_SURE);
}
function bystanderKaydetVeGec(puan) {
  bystanderSonrasiAktif = false;
  for (var i=1; i<=6; i++) document.getElementById('bys-n-'+i).classList.remove('secildi');
  document.getElementById('bys-n-'+puan).classList.add('secildi');
  var sn = bystanderSira[bystanderIndex];
  veri.bystander.push({senaryo_id:sn.id, gosterim_sirasi:bystanderIndex+1, ahlak_puani:puan});
  bystanderIndex++;
  setTimeout(function(){
    if (bystanderIndex < bystanderSira.length) bystanderOncesiGoster();
    else ekranGec('ekran-ss-aktor-aciklama');
  }, 300);
}

function ssBaslat() {
  // Sadece SS Aktör bloğunu (1-2) başlat
  ssAktorSira = karistir(SS_AKTOR_SENARYOLARI);
  ssBystSira  = karistir(SS_BYSTANDER_SENARYOLARI);
  ssAktorIndex = 0; ssBystIndex = 0;
  veri.ss = [];
  veri.ss_aktor_sirasi   = ssAktorSira.map(function(s){return s.id;});
  veri.ss_bystander_sirasi = ssBystSira.map(function(s){return s.id;});
  ssAktif = 'aktor';
  ssSira  = ssAktorSira; ssIndex = 0;
  ssOncesiGoster();
}
function ssBystanderBaslat() {
  // Bystander instruction sonrası SS Bystander bloğunu (3-6) başlat
  ssAktif = 'bystander';
  ssSira  = ssBystSira; ssIndex = 0;
  ssOncesiGoster();
}
function ssOncesiGoster() {
  var toplam = ssSira.length, sn = ssSira[ssIndex];
  var metin = 'Senaryo '+(ssIndex+1)+' / '+toplam;
  var pct   = (ssIndex/toplam)*100;
  document.getElementById('ss-ilerleme-metin').textContent = metin;
  document.getElementById('ss-ilerleme-ic').style.width    = pct+'%';
  document.getElementById('ss-gorsel-once').src = sn.once;
  ssOncesiAktif=true; ssSonrasiAktif=false;
  ekranGec('ekran-ss-once');
  var preload = new Image(); preload.src = sn.sonra;

  ssTimerId = setTimeout(function(){
    ssOncesiAktif = false;
    if (sn.tip === 'dk') {
      var sonraImg = document.getElementById('ss-gorsel-sonra-dk');
      fixationGoster(6, 'SS Senaryoları', metin, pct, 'ekran-ss-sonra-dk', sonraImg, sn.sonra, function(){
        document.getElementById('ss-tus-d').className = 'tus-kutu';
        document.getElementById('ss-tus-k').className = 'tus-kutu';
        ssDkYanitVerildi = false;
        ssSonrasiAktif   = true;
        ssDkBaslangicZamani = Date.now();
        ssDkTimerId = setTimeout(function(){
          if (!ssDkYanitVerildi) { ssDkYanitVerildi=true; ssKaydetVeGec(null,null); }
        }, SS_DK_SURE*1000);
      });
    } else {
      var sonraImg2 = document.getElementById('ss-gorsel-sonra-likert');
      fixationGoster(6, 'SS Senaryoları', metin, pct, 'ekran-ss-sonra-likert', sonraImg2, sn.sonra, function(){
        for (var i=1; i<=6; i++) document.getElementById('ss-n-'+i).classList.remove('secildi');
        ssSonrasiAktif = true;
      });
    }
  }, SS_ONCE_SURE);
}
function ssKaydetVeGec(basin_tus, puan) {
  ssSonrasiAktif = false;
  if (ssDkTimerId) { clearTimeout(ssDkTimerId); ssDkTimerId=null; }
  var sn    = ssSira[ssIndex];
  var kayit = { senaryo_id:sn.id, gosterim_sirasi:ssIndex+1, tip:sn.tip };
  if (sn.tip === 'dk') {
    var tepki = parseFloat(((Date.now()-ssDkBaslangicZamani)/1000).toFixed(3));
    if (basin_tus==='D') document.getElementById('ss-tus-d').className='tus-kutu secildi';
    else if (basin_tus==='K') document.getElementById('ss-tus-k').className='tus-kutu secildi';
    kayit.basin_tus    = basin_tus!==null ? basin_tus : "YOK";
    kayit.tepki_suresi = basin_tus!==null ? tepki : SS_DK_SURE;
  } else {
    for (var i=1; i<=6; i++) document.getElementById('ss-n-'+i).classList.remove('secildi');
    document.getElementById('ss-n-'+puan).classList.add('secildi');
    kayit.ahlak_puani = puan;
  }
  veri.ss.push(kayit);
  ssIndex++;
  setTimeout(function(){
    if (ssIndex < ssSira.length) {
      ssOncesiGoster();
    } else if (ssAktif === 'aktor') {
      // Aktör bloğu bitti → Bystander instruction ekranına git
      ekranGec('ekran-ss-bystander-aciklama');
    } else {
      // Her iki blok da bitti → veri gönder
      veriGonder();
    }
  }, 300);
}

function klavyeDinle(e) {
  var tus = e.key.toUpperCase();
  if (document.getElementById('ekran-aktor').classList.contains('aktif')) {
    if ((tus==='D'||tus==='K') && !aktorYanitVerildi) {
      aktorYanitVerildi=true; aktorKaydetVeGec(tus);
    }
    return;
  }
  if (bystanderOncesiAktif) { e.preventDefault(); return; }
  if (bystanderSonrasiAktif) {
    var s = parseInt(e.key);
    if (s>=1 && s<=6) bystanderKaydetVeGec(s);
    return;
  }
  if (ssOncesiAktif) { e.preventDefault(); return; }
  if (ssSonrasiAktif && ssSira[ssIndex] && ssSira[ssIndex].tip==='dk') {
    if ((tus==='D'||tus==='K') && !ssDkYanitVerildi) {
      ssDkYanitVerildi=true; ssKaydetVeGec(tus,null);
    }
    return;
  }
  if (ssSonrasiAktif && ssSira[ssIndex] && ssSira[ssIndex].tip==='likert') {
    var s2 = parseInt(e.key);
    if (s2>=1 && s2<=6) ssKaydetVeGec(null, s2);
  }
}

function veriGonder() {
  ekranGec('ekran-gonderim');
  veri.zaman    = new Date().toISOString();
  veri.tarayici = navigator.userAgent;
  fetch(GOOGLE_SCRIPT_URL, {
    method:'POST', mode:'no-cors',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify(veri)
  }).then(function(){ ekranGec('ekran-bitis'); })
    .catch(function(){ ekranGec('ekran-bitis'); });
}
</script>
</body>
</html>
